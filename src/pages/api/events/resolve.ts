import type { NextApiRequest, NextApiResponse } from 'next'; import { getEvent } from '@/lib/db'; export default function handler(req:NextApiRequest,res:NextApiResponse){ const slug=String(req.query.slug||''); const role=String(req.query.r||''); const t=String(req.query.t||''); const e=getEvent(slug); if(!e) return res.status(404).json({error:'event'}); const r=(e as any).roles[role]; if(!r||r.token!==t) return res.status(401).json({error:'role token'}); const dest = role==='viewer'?`/event/${slug}/viewer`: role==='producer'?`/event/${slug}/producer`: role==='director'?`/event/${slug}/director`: role==='scorekeeper'?`/event/${slug}/clock`: role==='refRemote'?`/event/${slug}/clock`: `/event/${slug}/viewer`; res.json({ dest }); }
