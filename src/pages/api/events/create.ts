import type { NextApiRequest, NextApiResponse } from 'next'; import { createEvent } from '@/lib/db'; export default function handler(req:NextApiRequest,res:NextApiResponse){ if(req.method!=='POST') return res.status(405).json({error:'method'}); const admin=req.headers['x-admin']; if(admin!==process.env.ORGANIZER_ADMIN_SECRET) return res.status(401).json({error:'unauthorized'}); const {name,dateISO,orgId}=req.body||{}; if(!name||!dateISO||!orgId) return res.status(400).json({error:'missing'}); const evt=createEvent({name,dateISO,orgId}); res.json({slug:evt.slug,event:evt}); }
